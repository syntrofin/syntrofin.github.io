<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Syntrofin Demo Login</title>
    <!-- Use relative paths for Vercel deployment efficiency -->
    <link rel="stylesheet" href="./syntrofin_files/cssjs/login.css">
</head>
<body>
    <h1>Syntrofin Login</h1>

    <div class="login-container">
        <input id="user" placeholder="User ID" autocomplete="username">
        <input id="pass" type="password" placeholder="Password" autocomplete="current-password">
        <button id="login-btn">Login</button>
    </div>

    <!-- START OF JAVASCRIPT CODE -->
    <script>
      // The main function that runs when the button is clicked
      async function login() {
        const user = document.getElementById('user').value;
        const pass = document.getElementById('pass').value;

        // Visual feedback
        const btn = document.getElementById('login-btn');
        btn.disabled = true;
        btn.innerText = "Checking...";

        try {
          // CALLING THE VERCEL API: Use your specific absolute URL
          const response = await fetch('https://auth-phi-seven.vercel.app/auth/api', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ userId: user, password: pass })
          });

          if (!response.ok) throw new Error('Network response was not ok');

          const result = await response.json();

          // Check for the "yes" flag from your Vercel Function
          if (result.auth === "yes") {
            console.log("Success! Welcome.");
        

            // 1. Read the 'redirect_to' parameter from the current URL
            const urlParams = new URLSearchParams(window.location.search);
            // 2. Set default redirect to homepage '/' if parameter is missing
            const redirectTo = urlParams.get('redirect_to') || '/'; 

            // 3. Perform the redirect to the correct page
            window.location.href = redirectTo;

          } else {
            console.warn("Access Denied.");
            alert("Access Denied: Invalid Credentials.");
          }
        } catch (error) {
          console.error("API Call Failed:", error);
          alert("Connection Error. Please try again later.");
        } finally {
          // Re-enable button after attempt
          btn.disabled = false;
          btn.innerText = "Login";
        }
      }

      // Attach the event listener to the button
      document.getElementById('login-btn').addEventListener('click', login);
    </script>
    <!-- END OF JAVASCRIPT CODE -->

</body>
</html>
